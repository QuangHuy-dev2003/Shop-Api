# üöÄ BULK IMPORT S·∫¢N PH·∫®M - H∆Ø·ªöNG D·∫™N HO√ÄN CH·ªàNH

## üìã T·ªïng quan

T√≠nh nƒÉng bulk import s·∫£n ph·∫©m t·ª´ Excel ƒë√£ ƒë∆∞·ª£c ho√†n thi·ªán v·ªõi ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng:

- ‚úÖ **T·∫°o template Excel t·ª± ƒë·ªông** v·ªõi d·ªØ li·ªáu m·∫´u v√† h∆∞·ªõng d·∫´n
- ‚úÖ **Import d·ªØ li·ªáu t·ª´ Excel** v·ªõi validation ƒë·∫ßy ƒë·ªß
- ‚úÖ **X·ª≠ l√Ω l·ªói th√¥ng minh** v·ªõi file Excel l·ªói ƒë∆∞·ª£c highlight
- ‚úÖ **T·ª± ƒë·ªông t·∫°o category/brand** n·∫øu ch∆∞a t·ªìn t·∫°i
- ‚úÖ **Li√™n k·∫øt ·∫£nh v·ªõi m√†u s·∫Øc** s·∫£n ph·∫©m
- ‚úÖ **T√≠nh to√°n stock quantity** t·ª´ c√°c variants

## üîó API Endpoints

### 1. Download Excel Template

```http
GET /api/v1/products/download-excel-template
Authorization: Bearer {jwt_token}
```

### 2. Import Products from Excel

```http
POST /api/products/import-products-from-excel
Content-Type: multipart/form-data
Authorization: Bearer {jwt_token}
Body: file (Excel file)
```

## üìä Format Excel

### C·∫•u tr√∫c c·ªôt:

| A              | B              | C           | D             | E          | F     | G    | H       | I                | J          |
| -------------- | -------------- | ----------- | ------------- | ---------- | ----- | ---- | ------- | ---------------- | ---------- |
| Product Code\* | Product Name\* | Description | Category Name | Brand Name | Color | Size | Price\* | Stock Quantity\* | Image URLs |

### Quy t·∫Øc d·ªØ li·ªáu:

| C·ªôt            | B·∫Øt bu·ªôc | M√¥ t·∫£                                | V√≠ d·ª•                                                       |
| -------------- | -------- | ------------------------------------ | ----------------------------------------------------------- |
| Product Code   | ‚úÖ       | M√£ s·∫£n ph·∫©m duy nh·∫•t (nh√≥m variants) | "JC8004", "SP001"                                           |
| Product Name   | ‚úÖ       | T√™n s·∫£n ph·∫©m                         | "ADIDAS HOUSE OF TIRO NATIONS PACK TEE"                     |
| Description    | ‚ùå       | M√¥ t·∫£ s·∫£n ph·∫©m                       | "√Åo th·ªÉ thao Adidas cao c·∫•p"                                |
| Category Name  | ‚ùå       | T√™n danh m·ª•c (t·ª± t·∫°o n·∫øu ch∆∞a c√≥)    | "√Åo th·ªÉ thao"                                               |
| Brand Name     | ‚ùå       | T√™n th∆∞∆°ng hi·ªáu (t·ª± t·∫°o n·∫øu ch∆∞a c√≥) | "Adidas"                                                    |
| Color          | ‚ùå       | M√†u s·∫Øc variant                      | "Tr·∫Øng", "V√†ng"                                             |
| Size           | ‚ùå       | K√≠ch th∆∞·ªõc (enum c√≥ s·∫µn)             | "S", "M", "L", "XL"                                         |
| Price          | ‚úÖ       | Gi√° s·∫£n ph·∫©m (VND)                   | 1050000                                                     |
| Stock Quantity | ‚úÖ       | S·ªë l∆∞·ª£ng t·ªìn kho                     | 5                                                           |
| Image URLs     | ‚ùå       | URL ·∫£nh (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)    | "https://example.com/img1.jpg,https://example.com/img2.jpg" |

### Size h·ª£p l·ªá:

#### √Åo:

- XS, S, M, L, XL, XXL, XXXL

#### Gi√†y:

- SIZE_36, SIZE_37, SIZE_38, SIZE_39, SIZE_40, SIZE_41, SIZE_42, SIZE_43, SIZE_44, SIZE_45, SIZE_46

#### Qu·∫ßn:

- WAIST_28, WAIST_29, WAIST_30, WAIST_31, WAIST_32, WAIST_33, WAIST_34, WAIST_35, WAIST_36
- WAIST_38, WAIST_40, WAIST_42, WAIST_44, WAIST_46, WAIST_48, WAIST_50

## üõ†Ô∏è C√°ch s·ª≠ d·ª•ng

### B∆∞·ªõc 1: T·∫£i template Excel

```bash
curl -X GET "http://localhost:8080/api/v1/products/download-excel-template" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -o product_template.xlsx
```

### B∆∞·ªõc 2: Chu·∫©n b·ªã d·ªØ li·ªáu

1. M·ªü file `product_template.xlsx`
2. ƒê·ªçc h∆∞·ªõng d·∫´n trong Sheet 2
3. ƒêi·ªÅn d·ªØ li·ªáu v√†o Sheet 1 theo format
4. Upload ·∫£nh l√™n Cloudinary v√† l·∫•y URL

### B∆∞·ªõc 3: Import d·ªØ li·ªáu

```bash
curl -X POST "http://localhost:8080/api/v1/products/import-products-from-excel" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@your_data.xlsx"
```

## üìù V√≠ d·ª• d·ªØ li·ªáu

### V√≠ d·ª• 1: S·∫£n ph·∫©m Adidas v·ªõi nhi·ªÅu m√†u v√† size

**Th√¥ng tin s·∫£n ph·∫©m:**

- T√™n: ADIDAS HOUSE OF TIRO NATIONS PACK TEE
- M√£: JC8004
- Gi√°: 1,050,000 VND
- Brand: Adidas
- Category: √Åo th·ªÉ thao
- M√†u Tr·∫Øng: Size S, L (s·ªë l∆∞·ª£ng: 5)
- M√†u V√†ng: Size M, S, L, XL (s·ªë l∆∞·ª£ng: 10)

**D·ªØ li·ªáu Excel:**

| Product Code | Product Name                          | Description                | Category Name | Brand Name | Color | Size | Price   | Stock Quantity | Image URLs                                       |
| ------------ | ------------------------------------- | -------------------------- | ------------- | ---------- | ----- | ---- | ------- | -------------- | ------------------------------------------------ |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | Tr·∫Øng | S    | 1050000 | 5              | https://res.cloudinary.com/example/white.jpg     |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | Tr·∫Øng | L    | 1050000 | 5              | https://res.cloudinary.com/example/white.jpg     |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | V√†ng  | M    | 1050000 | 10             | https://res.cloudinary.com/example/yellow_m.jpg  |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | V√†ng  | S    | 1050000 | 10             | https://res.cloudinary.com/example/yellow_s.jpg  |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | V√†ng  | L    | 1050000 | 10             | https://res.cloudinary.com/example/yellow_l.jpg  |
| JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | √Åo th·ªÉ thao Adidas cao c·∫•p | √Åo th·ªÉ thao   | Adidas     | V√†ng  | XL   | 1050000 | 10             | https://res.cloudinary.com/example/yellow_xl.jpg |

### V√≠ d·ª• 2: S·∫£n ph·∫©m gi√†y Nike v·ªõi nhi·ªÅu m√†u

```
SP001 | Nike Air Max 270 | Gi√†y ch·∫°y b·ªô tho·∫£i m√°i | Running Shoes | Nike | Red | SIZE_42 | 1500000 | 10 | https://res.cloudinary.com/example/red.jpg
SP001 | Nike Air Max 270 | Gi√†y ch·∫°y b·ªô tho·∫£i m√°i | Running Shoes | Nike | Blue | SIZE_42 | 1500000 | 5 | https://res.cloudinary.com/example/blue.jpg
```

### V√≠ d·ª• 3: S·∫£n ph·∫©m √°o v·ªõi nhi·ªÅu size

```
SP002 | Adidas T-Shirt | √Åo thun th·ªÉ thao | T-Shirts | Adidas | Black | S | 500000 | 15 | https://res.cloudinary.com/example/black.jpg
SP002 | Adidas T-Shirt | √Åo thun th·ªÉ thao | T-Shirts | Adidas | Black | M | 500000 | 20 | https://res.cloudinary.com/example/black.jpg
SP002 | Adidas T-Shirt | √Åo thun th·ªÉ thao | T-Shirts | Adidas | Black | L | 500000 | 12 | https://res.cloudinary.com/example/black.jpg
```

## üì§ Response Examples

### Success Response:

```json
{
  "success": true,
  "message": "Import th√†nh c√¥ng",
  "data": {
    "successCount": 6,
    "errorCount": 0,
    "errors": []
  }
}
```

### K·∫øt qu·∫£ trong Database:

**B·∫£ng `products`:**

```sql
| id | product_code | name                                | price    | category_id | brand_id | stock_quantity |
|----|--------------|-------------------------------------|----------|-------------|----------|----------------|
| 1  | JC8004       | ADIDAS HOUSE OF TIRO NATIONS PACK TEE | 1050000  | 1           | 1        | 60             |
```

**B·∫£ng `product_variants`:**

```sql
| id | product_id | color | size | price    | stock_quantity |
|----|------------|-------|------|----------|----------------|
| 1  | 1          | Tr·∫Øng | S    | 1050000  | 5              |
| 2  | 1          | Tr·∫Øng | L    | 1050000  | 5              |
| 3  | 1          | V√†ng  | M    | 1050000  | 10             |
| 4  | 1          | V√†ng  | S    | 1050000  | 10             |
| 5  | 1          | V√†ng  | L    | 1050000  | 10             |
| 6  | 1          | V√†ng  | XL   | 1050000  | 10             |
```

**B·∫£ng `product_images`:**

```sql
| id | product_id | image_url                                    | color |
|----|------------|----------------------------------------------|-------|
| 1  | 1          | https://res.cloudinary.com/example/white.jpg | Tr·∫Øng |
| 2  | 1          | https://res.cloudinary.com/example/yellow_m.jpg | V√†ng  |
| 3  | 1          | https://res.cloudinary.com/example/yellow_s.jpg | V√†ng  |
| 4  | 1          | https://res.cloudinary.com/example/yellow_l.jpg | V√†ng  |
| 5  | 1          | https://res.cloudinary.com/example/yellow_xl.jpg | V√†ng  |
```

**L∆∞u √Ω:** ·∫¢nh m√†u Tr·∫Øng ch·ªâ l∆∞u 1 l·∫ßn cho c·∫£ 2 variants (S, L), kh√¥ng duplicate.

### Partial Success (with errors):

```json
{
  "success": true,
  "message": "Import th√†nh c√¥ng",
  "data": {
    "successCount": 2,
    "errorCount": 1,
    "errors": [
      {
        "row": 3,
        "error": "Size kh√¥ng h·ª£p l·ªá: INVALID_SIZE. C√°c size h·ª£p l·ªá: XS, S, M, L, XL, XXL, XXXL, SIZE_36-SIZE_46, WAIST_28-WAIST_50"
      }
    ],
    "errorFile": "File l·ªói ƒë√£ ƒë∆∞·ª£c t·∫°o"
  }
}
```

## üîß T√≠nh nƒÉng n√¢ng cao

### 1. Logic Nh√≥m Variants

- **Product Code duy nh·∫•t**: M·ªói s·∫£n ph·∫©m c√≥ 1 Product Code ri√™ng
- **T·ª± ƒë·ªông nh√≥m variants**: C√°c d√≤ng c√πng Product Code ‚Üí c√πng 1 s·∫£n ph·∫©m
- **T√≠nh to√°n stock t·ªïng**: T·ªïng stock c·ªßa t·∫•t c·∫£ variants
- **Li√™n k·∫øt ·∫£nh theo m√†u**: ·∫¢nh ƒë∆∞·ª£c g√°n m√†u t∆∞∆°ng ·ª©ng v·ªõi variant
- **Tr√°nh duplicate ·∫£nh**: Ch·ªâ l∆∞u ·∫£nh 1 l·∫ßn cho m·ªói m√†u, kh√¥ng l∆∞u l·∫°i cho c√°c variants c√πng m√†u

### 2. Excel Template Generation

- **T·ª± ƒë·ªông t·∫°o template** v·ªõi d·ªØ li·ªáu m·∫´u
- **H∆∞·ªõng d·∫´n chi ti·∫øt** trong sheet th·ª© 2
- **Format chuy√™n nghi·ªáp** v·ªõi styling ƒë·∫πp

### 2. Smart Data Processing

- **Auto-create categories/brands** n·∫øu ch∆∞a t·ªìn t·∫°i
- **Link images to colors** t·ª± ƒë·ªông
- **Calculate total stock** t·ª´ variants
- **Handle various cell types** (string, numeric, formula)

### 3. Advanced Error Handling

- **Row-by-row error reporting** v·ªõi chi ti·∫øt c·ª• th·ªÉ
- **Error file generation** v·ªõi highlight ƒë·ªè
- **Comprehensive validation** cho t·∫•t c·∫£ fields
- **Size enum validation** v·ªõi th√¥ng b√°o r√µ r√†ng

### 4. File Management

- **Read only first sheet** ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n
- **Support .xlsx format** hi·ªán ƒë·∫°i
- **Memory efficient** processing

## üß™ Test Cases

### 1. Template Download Test

```bash
# Test download template
curl -X GET "http://localhost:8080/api/products/download-excel-template" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -o test_template.xlsx
```

### 2. Valid Import Test

```bash
# Test import with valid data
curl -X POST "http://localhost:8080/api/products/import-products-from-excel" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@valid_data.xlsx"
```

### 3. Error Handling Test

```bash
# Test import with invalid data
curl -X POST "http://localhost:8080/api/products/import-products-from-excel" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "file=@invalid_data.xlsx"
```

## ‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng

### 1. Template Usage

- **Lu√¥n s·ª≠ d·ª•ng template** ƒë√£ t·∫£i v·ªÅ ƒë·ªÉ ƒë·∫£m b·∫£o format ƒë√∫ng
- **Kh√¥ng x√≥a d√≤ng header** (d√≤ng 1)
- **Ch·ªâ ƒëi·ªÅn d·ªØ li·ªáu** v√†o Sheet 1
- **Product Code ph·∫£i gi·ªëng nhau** cho c√°c variants c·ªßa c√πng 1 s·∫£n ph·∫©m

### 2. Data Validation

- **Product Code, Product Name, Price, Stock Quantity** l√† b·∫Øt bu·ªôc
- **Product Code** ph·∫£i duy nh·∫•t cho m·ªói s·∫£n ph·∫©m (c√°c variants c√πng s·∫£n ph·∫©m d√πng chung Product Code)
- **Size** ph·∫£i s·ª≠ d·ª•ng ƒë√∫ng enum values
- **Price** ph·∫£i > 0 (VND)
- **Stock Quantity** ph·∫£i >= 0

### 3. Image Management

- **Upload ·∫£nh tr∆∞·ªõc** l√™n Cloudinary
- **S·ª≠ d·ª•ng URL ·∫£nh** trong Excel
- **Ph√¢n c√°ch nhi·ªÅu URL** b·∫±ng d·∫•u ph·∫©y

### 4. Error Handling

- **Ki·ªÉm tra response** ƒë·ªÉ bi·∫øt k·∫øt qu·∫£
- **S·ª≠ d·ª•ng file l·ªói** ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông
- **S·ª≠a l·ªói v√† import l·∫°i** n·∫øu c·∫ßn

## üêõ Troubleshooting

### L·ªói th∆∞·ªùng g·∫∑p:

| L·ªói                                | Nguy√™n nh√¢n                 | Gi·∫£i ph√°p                        |
| ---------------------------------- | --------------------------- | -------------------------------- |
| "Product code kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng" | Thi·∫øu m√£ s·∫£n ph·∫©m           | ƒêi·ªÅn m√£ s·∫£n ph·∫©m v√†o c·ªôt A       |
| "Product name kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng" | Thi·∫øu t√™n s·∫£n ph·∫©m          | ƒêi·ªÅn t√™n s·∫£n ph·∫©m v√†o c·ªôt B      |
| "Price ph·∫£i l·ªõn h∆°n 0"             | Gi√° <= 0 ho·∫∑c kh√¥ng ph·∫£i s·ªë | Ki·ªÉm tra gi√° trong c·ªôt H         |
| "Size kh√¥ng h·ª£p l·ªá"                | Size kh√¥ng ƒë√∫ng enum        | S·ª≠ d·ª•ng size t·ª´ danh s√°ch h·ª£p l·ªá |
| "File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng"        | File kh√¥ng ph·∫£i .xlsx       | Chuy·ªÉn ƒë·ªïi file sang .xlsx       |

### Debug Tips:

1. **Ki·ªÉm tra response error** ƒë·ªÉ bi·∫øt chi ti·∫øt l·ªói
2. **S·ª≠ d·ª•ng file l·ªói** ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông
3. **Test t·ª´ng d√≤ng** ri√™ng l·∫ª
4. **Xem log server** ƒë·ªÉ debug

## üìà Performance

### T·ªëi ∆∞u h√≥a:

- **Batch processing** cho file l·ªõn
- **Memory efficient** Excel reading
- **Transaction management** cho data consistency
- **Error isolation** (l·ªói 1 d√≤ng kh√¥ng ·∫£nh h∆∞·ªüng d√≤ng kh√°c)

### Gi·ªõi h·∫°n:

- **File size**: Khuy·∫øn ngh·ªã < 10MB
- **Number of rows**: Khuy·∫øn ngh·ªã < 1000 rows
- **Image URLs**: Khuy·∫øn ngh·ªã < 10 URLs per row

## üîÆ Roadmap

### T√≠nh nƒÉng s·∫Øp t·ªõi:

- [ ] **Export d·ªØ li·ªáu hi·ªán t·∫°i** ra Excel
- [ ] **Dashboard th·ªëng k√™** import
- [ ] **Validation n√¢ng cao** (regex, format check)
- [ ] **Support CSV format**
- [ ] **Bulk update** s·∫£n ph·∫©m hi·ªán c√≥
- [ ] **Template customization** theo category
- [ ] **Auto-generate Product Code** t·ª´ t√™n s·∫£n ph·∫©m
- [ ] **Bulk variant management** (th√™m/x√≥a variants cho s·∫£n ph·∫©m hi·ªán c√≥)

### C·∫£i ti·∫øn:

- [ ] **Performance optimization** cho file l·ªõn
- [ ] **Real-time progress** tracking
- [ ] **Background processing** cho file l·ªõn
- [ ] **Email notification** khi import ho√†n th√†nh

## üìû Support

N·∫øu g·∫∑p v·∫•n ƒë·ªÅ, vui l√≤ng:

1. Ki·ªÉm tra **t√†i li·ªáu h∆∞·ªõng d·∫´n** n√†y
2. Xem **file l·ªói** ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông
3. Ki·ªÉm tra **log server** ƒë·ªÉ debug
4. Li√™n h·ªá **development team** n·∫øu c·∫ßn h·ªó tr·ª£

---

**üéâ Ch√∫c b·∫°n s·ª≠ d·ª•ng t√≠nh nƒÉng bulk import hi·ªáu qu·∫£!**
